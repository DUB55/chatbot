# DUB5 AI Integration Guide

This guide provides instructions on how to integrate and utilize the DUB5 AI functionality, with a specific focus on leveraging the "coder" personality for web application development.

## Deployed URL

The DUB5 AI backend is deployed and accessible at: `https://chatbot-beta-weld.vercel.app`

## 1. Understanding DUB5 AI Personalities

DUB5 AI offers different "personalities" to tailor its responses and capabilities. These are configured in the backend and can be selected when making requests to the API.

*   **General:** A helpful and professional assistant for general queries.
*   **Coder:** An AI editor specifically designed for creating and modifying web applications using standalone HTML, CSS, and JavaScript. This personality adheres to strict code generation guidelines, including the `BEGIN_FILE`/`END_FILE` format.
*   **Teacher:** A patient teacher that explains concepts simply with analogies.
*   **Writer:** A creative writer and storyteller.

## 2. Integrating DUB5 AI into Your Application

To integrate DUB5 AI, you will typically make HTTP POST requests to the `/api/chatbot` endpoint of the deployed backend.

### API Endpoint

`POST https://chatbot-beta-weld.vercel.app/api/chatbot`

### Request Body

The request body should be a JSON object with the following parameters:

*   `input` (string, required): The user's message or prompt.
*   `history` (array of objects, optional): An array of previous messages in the conversation. Each message object should have `role` (e.g., "user", "assistant") and `content` (string) properties.
*   `model` (string, optional): The AI model to use (e.g., "gpt-4o", "mistral", "llama"). Defaults to "auto" which selects a model based on the `thinking_mode`.
*   `thinking_mode` (string, optional): Influences the AI's approach (e.g., "balanced", "concise", "reason", "deep"). Defaults to "balanced".
*   `personality` (string, optional): **Crucially, set this to `"coder"` to activate the web app builder functionality.** Defaults to "general".
*   `custom_system_prompt` (string, optional): A custom system prompt to override the default personality prompt.
*   `force_roulette` (boolean, optional): If `true`, forces the AI to use a random provider, bypassing specialized layers.
*   `files` (array of objects, optional): An array of file objects, each with `name` and `content` (Base64 encoded or raw text). Used for providing context to the AI.
*   `image` (string, optional): Base64 encoded image data for image analysis.
*   `session_id` (string, optional): A unique identifier for the current session, used for project management (e.g., saving file changes). Defaults to "default".
*   `library_ids` (array of strings, optional): IDs of stored learning material for Retrieval Augmented Generation (RAG).

### Example Request (JavaScript Fetch API)

```javascript
async function sendDUB5Message(message, conversationHistory, selectedPersonality = "general") {
    const response = await fetch('https://chatbot-beta-weld.vercel.app/api/chatbot', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            input: message,
            history: conversationHistory,
            personality: selectedPersonality,
            // Other optional parameters like model, thinking_mode, files, etc.
        }),
    });

    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let result = '';

    while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value, { stream: true });
        // Process streaming chunks here
        // For example, you might parse 'data: ' lines for content and metadata
        result += chunk;
    }
    return result;
}

// Example usage for coder personality
// let history = []; // Your conversation history
// let userPrompt = "Create a simple HTML page with a blue background and a 'Hello DUB5' heading.";
// sendDUB5Message(userPrompt, history, "coder").then(response => {
//     console.log(response);
//     // Parse the response for BEGIN_FILE/END_FILE directives
// });
```

### Response Format (Streaming)

The API streams responses as Server-Sent Events (SSE). Each event will be a JSON object.

*   **Content Chunks:** `data: {"content": "..."}` - These contain the actual text generated by the AI.
*   **Metadata:** `data: {"type": "metadata", "model": "...", "personality": "..."}` - Provides information about the AI's processing.
*   **Done Event:** `data: {"type": "done", "files": [...]}` - Signals the end of the stream and may include a list of file changes (especially for the "coder" personality).

## 3. Using the "Coder" Personality for Web App Building

When the `personality` parameter is set to `"coder"`, DUB5 AI will act as a web application builder. It will adhere to the following critical guidelines:

*   **File Directives:** All code output will be in `BEGIN_FILE`/`END_FILE` format.
    ```
    BEGIN_FILE: index.html
    <!DOCTYPE html>
    <html>
    <head>
        <title>My App</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <h1>Hello DUB5</h1>
        <script src="script.js"></script>
    </body>
    </html>
    END_FILE
    ```
*   **Technology Stack:** It will exclusively generate standalone HTML, CSS, and JavaScript. No other frameworks (React, Next.js, etc.) will be used.
*   **Multi-file Outputs:** For complex requests, it will output multiple file blocks (e.g., `index.html`, `style.css`, `script.js`) back-to-back.
*   **Continuation Rule:** If the AI's response is truncated, you can prompt it with "Continue EXACTLY where you left off/stopped" to have it resume its output immediately without any additional conversational text.

### Example Interaction Flow with "Coder" Personality

1.  **User Prompt:** "Create a simple HTML page with a blue background and a 'Hello DUB5' heading. Also, add a JavaScript file that logs 'Page loaded!' to the console."
2.  **DUB5 AI (Coder) Response:**
    ```
    BEGIN_FILE: index.html
    <!DOCTYPE html>
    <html>
    <head>
        <title>Hello DUB5 App</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <h1>Hello DUB5</h1>
        <script src="script.js"></script>
    </body>
    </html>
    END_FILE

    BEGIN_FILE: style.css
    body {
        background-color: blue;
        color: white;
        font-family: sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
    }
    h1 {
        font-size: 3em;
    }
    END_FILE

    BEGIN_FILE: script.js
    console.log('Page loaded!');
    END_FILE
    ```
3.  **User Prompt (if response was cut off):** "Continue EXACTLY where you left off/stopped"
    *DUB5 AI would then continue generating the remaining part of the code or explanation without any preamble.*

## 4. Error Handling and Debugging

The DUB5 AI backend includes enhanced logging to help diagnose issues. If you encounter errors (e.g., HTTP 530), check the backend server logs for detailed information. The `api/chatbot_backup.py` file contains specific logging for external AI API calls, which can help pinpoint problems with upstream providers.

By following these instructions, you can effectively integrate and leverage the DUB5 AI functionality, particularly its powerful "coder" personality, for your web development needs.